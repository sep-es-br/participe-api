package br.gov.es.participe.service;

import java.io.BufferedOutputStream;
import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.OutputStream;
import java.util.Map;

import javax.imageio.ImageIO;
import javax.mail.MessagingException;
import javax.mail.internet.MimeMessage;
import javax.swing.JEditorPane;
import javax.xml.bind.DatatypeConverter;

import java.awt.Graphics;
import java.awt.image.BufferedImage;

import org.apache.commons.io.FileUtils;
import org.slf4j.Logger;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.core.io.FileSystemResource;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessageHelper;
import org.springframework.stereotype.Service;
import org.springframework.ui.freemarker.FreeMarkerTemplateUtils;

import freemarker.template.Configuration;
import freemarker.template.Template;
import freemarker.template.TemplateException;



@Service
public class EmailService {

	@Autowired
	private JavaMailSender mailSender;

	@Value("${spring.mail.username}")
	private String from;

	@Autowired
	private Configuration freemarkerConfig;

	@Autowired
	private Logger log;
	
	public void sendEmail(String to, String title, Map<String, String> data) {
		MimeMessage message = mailSender.createMimeMessage();
		
		MimeMessageHelper helper = new MimeMessageHelper(message);
		String body = null;
		
		try {

			body = generateBody(data);
			helper.setFrom(from);
			helper.setTo(to);
			helper.setText(body, true);
			helper.setSubject(title);
		} catch (MessagingException | IOException | TemplateException e) {
			log.error("Error template email", e);
		}

		mailSender.send(message);
	}

	public void sendEmailPreRegistration(String to, String title, Map<String, String> data) throws MessagingException {
		MimeMessage message = mailSender.createMimeMessage();
		
		MimeMessageHelper helper = new MimeMessageHelper(message, true);
		String body = null;
		
		try {
			body = generateBodyPreRegistration(data);
			helper.setFrom(from);
			helper.setTo(to);
			helper.setText(body, true);
			helper.setSubject(title);
			// FileSystemResource file = new FileSystemResource(new File("qrcodeteste.png"));
			helper.addAttachment("QRCODE.jpg", htmlToImage(body));
		} catch (Exception e ) {
			log.error("Error template email", e);
		}

		mailSender.send(message);
	}
	
	private String generateBody(Map<String, String> data) throws IOException, TemplateException {
		freemarkerConfig.setClassForTemplateLoading(this.getClass(), "/static");
		Template t = freemarkerConfig.getTemplate("emailBody.ftl");
        return FreeMarkerTemplateUtils.processTemplateIntoString(t, data);
	}

	private String generateBodyPreRegistration(Map<String, String> data) throws IOException, TemplateException {
		freemarkerConfig.setClassForTemplateLoading(this.getClass(), "/static");
		Template t = freemarkerConfig.getTemplate("preRegistrationQrCode.ftl");
		return FreeMarkerTemplateUtils.processTemplateIntoString(t, data);
	}


	private File htmlToImage(String html) throws Exception {
        int width = 530;
        int height = 600;

		BufferedImage image = new BufferedImage(width, height, BufferedImage.TYPE_INT_ARGB);

        JEditorPane jep = new JEditorPane("text/html", html);
        jep.setSize(width, height);

        Graphics graphics = image.createGraphics();

        jep.print(graphics);
		
        ByteArrayOutputStream out = new ByteArrayOutputStream();
        ImageIO.write(image, "png", out);
        File file = new File("qrcode.png");
        FileUtils.writeByteArrayToFile(file, out.toByteArray());
      	
		return file;
    }

	private File base64ToImage(){
		String img = "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";

		byte[] data = DatatypeConverter.parseBase64Binary(img);
		File file = new File("qrcode.jpg");
		
		try (OutputStream outputStream = new BufferedOutputStream(new FileOutputStream(file))){
			outputStream.write(data);
		} catch(Exception e){
			e.printStackTrace();
		}
		
		return file;


		// ByteArrayOutputStream out = new ByteArrayOutputStream();
        // ImageIO.write(image, "png", out);
        // File file = new File("qrcode.png");
        // FileUtils.writeByteArrayToFile(file, out.toByteArray());

		
	}

}
